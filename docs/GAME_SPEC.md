# Tin! Tilo! Rings! - ゲーム仕様書（開発者向け）

## 概要

Tin! Tilo! Rings!は、チンチロリン（Cee-lo）をベースにした3リール回転式ゲームです。
Phaser 3フレームワークを使用してTypeScriptで実装されています。

## ゲームの基本構造

### 画面サイズ

- 640x960px（縦長）
- 背景色: `#732121`

### シーン構成

1. **TitleScene** (`src/game/TitleScene.ts`)
   - タイトル画面
   - 9種類のルール選択メニュー（3×3グリッド）
   - インフォボタン（ゲーム説明へのリンク）

2. **MainScene** (`src/game/MainScene.ts`)
   - メインゲームプレイ画面
   - 3つのリング（左・中央・右）
   - スコア表示、時間表示、回数表示
   - 戻るボタン（タイトルへ）

## ゲームルール

### 9種類のルールタイプ

ルールは3つのカテゴリーに分類されます：

#### カテゴリー1: 時間制限（最速クリア）

- `rule_1_2943`: 2943点到達が目標
- `rule_1_8390`: 8390点到達が目標
- `rule_1_37654`: 37654点到達が目標

#### カテゴリー2: 回数制限

- `rule_2_2943`: 29回または43回以内に目標達成
- `rule_2_8390`: 83回または90回以内に目標達成
- `rule_2_37654`: 特定回数以内に目標達成

#### カテゴリー3: スコアアタック

- `rule_3_0409`: 409秒でのスコア
- `rule_3_2009`: 2009秒でのスコア
- `rule_3_6819`: 6819秒でのスコア

## リング（リール）システム

### 基本仕様

- 3本のリング（左・中央・右）
- 各リングには0-9の数字が表示される
- リングの色: 白（通常）、ピンク（ピンクリボン発動時）、黄色（トリプルセブンロールバック中）

### リング回転

1. 3本同時に回転開始（se_start.ogg, se_rotate.ogg）
2. 左リングが最初に停止（500msブレーキ）
3. 中央リングが次に停止（500msブレーキ）
4. 右リングが最後に停止（se_stop.ogg）

### スピード調整

- 基本速度: 4px/frame
- バレットタイム中: 2px/frame（遅く）
- スコアに応じて動的に変化（se_speed_up.ogg / se_speed_down.ogg）

## スコアリングシステム

### 評価ライン

リング停止後、11本のライン（a～k）で役を判定：

```
ライン a: [左0, 中0, 右0] - 一番上
ライン b: [左1, 中0, 右0]
ライン c: [左2, 中1, 右0]
...
ライン k: [左9, 中9, 右9] - 一番下
```

### 役（Roll）の種類

#### Multi（乗算系）

1. **ピンゾロ (pinzoro)**: [1,1,1] - 倍率10倍
2. **アラシカブ (arashikabu)**: ゾロ目で合計9 ([3,3,3]) - 倍率5倍
3. **ケモノ (kemono)**: ゾロ目で合計6 ([2,2,2]) - 倍率5倍
4. **トリプルセブン (triple_seven)**: [7,7,7] - 倍率7倍
5. **ゾロ目 (zorome)**: 同じ数字3つ - 倍率2倍
6. **シゴロ (shigoro)**: [4,5,6] - 倍率2倍
7. **ヒフミ (hifumi)**: [1,2,3] - 倍率2倍

#### Add（加算系）

8. **ピンクリボン (pink_ribbon)**: [1,0,9] - 加算+109
9. **ピンバサミ (pinbasami)**: [1,?,1] - 加算+10
10. **メ (me)**: 2つが同じ数字 - 加算+5

#### Kabu（カブ系 - mod 10の結果）

11. **ピン (pin)**: mod=1 - 加算+10
12. **ニゾウ (nizou)**: mod=2 - 加算+9
13. **サンタ (santa)**: mod=3 - 加算+8
14. **ヨツヤ (yotsuya)**: mod=4 - 加算+7
15. **ゴケ (goke)**: mod=5 - 加算+6
16. **ロッポウ (roppou)**: mod=6 - 加算+5
17. **シチケン (shichiken)**: mod=7 - 加算+4
18. **オイチョ (oicho)**: mod=8 - 加算+3
19. **カブ (kabu)**: mod=9 - 加算+2
20. **ブタ (buta)**: 役なし - スコア0

### スコア計算フロー

1. **Multi Step**: 乗算系の役を評価
2. **Me Step**: 加算系の役を評価（ピンクリボン、ピンバサミ、メ）
3. **Kabu Step**: カブ系の役を評価（mod 10の結果）

各ステップで最初にマッチした役のみが適用されます。

### コンボシステム

- 100点以上獲得でコンボ継続
- 100点未満でコンボリセット
- コンボ倍率: 2x, 3x, 4x, ... 10x（最大）

## 特殊機能

### リーチ（Reach）

2つのリングが停止した時点で役が成立する可能性がある場合、ガイド画像を表示：

- `guide_reach_a.png` ～ `guide_reach_k.png`
- voice_reach.ogg再生

### ゾーンシステム

#### ゾーントリガー

特定の3数字の組み合わせでゾーンモード突入：

- 110, 359, 427, 488, 501, 564, 712, 893, 931

#### ゾーンモードの種類

**バレットタイム (Bullet Time)**

- リング速度が半分になる（2px/frame）
- BGMボリューム低下（0.2 → 0.1）
- 背景エフェクト: `bg_bullet_time.png`
- 効果音: se_start_bullet_time.ogg, voice_bullet_time.ogg
- 持続時間: 30秒

**レボリューション (Revolution)**

- スコアが2倍になる
- BGMボリューム低下
- 背景エフェクト: `bg_revolution.png`
- 効果音: se_start_revolution.ogg, voice_revolution.ogg, se_finish_revolution.ogg
- 持続時間: 30秒

### トリプルセブン効果

[7,7,7]が出現した場合、確率的に以下の効果が発動：

1. **all_1**: 全リングが1だけになる
2. **all_6**: 全リングが6だけになる
3. **all_123**: リング1が1,2,3、リング2が1,2,3、リング3が1,2,3
4. **all_456**: リング1が4,5,6、リング2が4,5,6、リング3が4,5,6
5. **triplets**: ゾロ目が出やすくなる
6. **rollback**: ロールバック機能（リーチ時に右リールを再回転）

### アンビュランス（救急車）

特定の組み合わせで時間が10秒戻る（時間ペナルティ）

- 効果音: se_ambulance.ogg

## アーキテクチャ

### ディレクトリ構造

```
src/game/
├── AudioManager.ts    # BGM・効果音管理
├── TitleScene.ts      # タイトル画面
├── MainScene.ts       # メインゲーム画面
├── config.ts          # Phaser設定
├── rolls.ts           # 役の定義
└── rule.ts            # ゲームロジック

public/assets/
├── bgm/              # BGMファイル（5曲）
├── image/
│   ├── ring/         # リング画像（白、ピンク、黄、グレー × 0-9）
│   ├── bg/           # 背景画像（37種類）
│   ├── title/        # タイトル画面素材
│   ├── guide/        # リーチガイド画像
│   ├── score/        # スコア表示画像
│   └── effect/       # エフェクト画像
└── sound/            # 効果音（71ファイル）
```

### 主要クラス

#### AudioManager

- BGM管理（looping、volume調整）
- 効果音再生
- BGM切り替え（毎分）

#### Rule（静的メソッド群）

- `shuffle()`: 配列シャッフル
- `getReaches()`: リーチ判定
- `getZoneReaches()`: ゾーンリーチ判定
- `calcTuples()`: 11ラインの組み合わせ計算
- `calcMods()`: mod 10計算
- `calcScores()`: スコア計算（Multi→Me→Kabu）
- `getTripleSevenEffect()`: トリプルセブン効果決定
- `isAchieved()`: クリア判定

## デバッグ・テスト

### ローカル実行

```bash
npm run dev
```

### ビルド

```bash
npm run build
```

### 主要な確認ポイント

1. リングが正しく回転・停止するか
2. リーチ判定が正しく表示されるか
3. スコア計算が正確か
4. ゾーンモードが正しく動作するか
5. BGM・効果音が適切なタイミングで再生されるか
6. トリプルセブン効果が発動するか
7. クリア判定が正しいか

## パフォーマンス

- 400以上のアセットファイル（画像・音声）
- バンドルサイズ: ~1.6MB（gzip: ~395KB）
- 60fps動作

## 今後の改善案

1. リザルト画面の詳細化（全役の統計表示）
2. ハイスコアのローカルストレージ保存
3. アニメーション強化（パーティクル効果など）
4. モバイル対応の最適化
5. 多言語対応（日本語・英語）
